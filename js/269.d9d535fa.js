"use strict";(self["webpackChunkmrpotato"]=self["webpackChunkmrpotato"]||[]).push([[269],{7676:function(e,t,a){a.d(t,{Z:function(){return v}});var o=a(3396),s=a(7139),n=a(9242);const d={class:"d-flex justify-content-center mt-md-5 mt-3"},i={"aria-label":"Page navigation"},l={class:"pagination"},p=(0,o._)("span",{"aria-hidden":"true"},"«",-1),u=[p],c=["onClick"],r=(0,o._)("span",{"aria-hidden":"true"},"»",-1),m=[r];function h(e,t,a,p,r,h){return(0,o.wg)(),(0,o.iD)("div",d,[(0,o._)("nav",i,[(0,o._)("ul",l,[(0,o._)("li",{class:(0,s.C_)([{disabled:!a.paginationData.has_pre},"page-item"])},[(0,o._)("a",{onClick:t[0]||(t[0]=(0,n.iM)((e=>h.updatedPagination(a.paginationData.current_page-1)),["prevent"])),class:"page-link",href:"#","aria-label":"Previous"},u)],2),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.paginationData.total_pages,(e=>((0,o.wg)(),(0,o.iD)("li",{key:e,class:(0,s.C_)([{active:a.paginationData.current_page===e},"page-item"])},[(0,o._)("a",{onClick:(0,n.iM)((t=>h.updatedPagination(e)),["prevent"]),class:"page-link",href:"#"},(0,s.zw)(e),9,c)],2)))),128)),(0,o._)("li",{class:(0,s.C_)([{disabled:!a.paginationData.has_next},"page-item"])},[(0,o._)("a",{onClick:t[1]||(t[1]=(0,n.iM)((e=>h.updatedPagination(a.paginationData.current_page+1)),["prevent"])),class:"page-link",href:"#","aria-label":"Next"},m)],2)])])])}var _={name:"DashboardPagination",props:["paginationData"],methods:{updatedPagination(e){this.$emit("getPagination",e)}}},b=a(89);const g=(0,b.Z)(_,[["render",h]]);var v=g},9726:function(e,t,a){a.d(t,{Z:function(){return v}});var o=a(3396),s=a(7139);const n={class:"modal fade",id:"removeModal",tabindex:"-1","aria-labelledby":"removeModalLabel","aria-hidden":"true",ref:"removeModal"},d={class:"modal-dialog"},i={class:"modal-content"},l=(0,o._)("div",{class:"modal-header bg-danger text-white"},[(0,o._)("h1",{class:"modal-title fs-5",id:"removeModalLabel"},"刪除"),(0,o._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),p={class:"modal-body py-6 text-start"},u={class:"text-primary"},c={class:"modal-footer"},r=(0,o._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function m(e,t,a,m,h,_){return(0,o.wg)(),(0,o.iD)("div",n,[(0,o._)("div",d,[(0,o._)("div",i,[l,(0,o._)("div",p,[(0,o.Uk)(" 確定要刪除 "),(0,o._)("strong",u,(0,s.zw)(h.item.title),1),(0,o.Uk)("？ ")]),(0,o._)("div",c,[r,(0,o._)("button",{onClick:t[0]||(t[0]=(...e)=>_.removeData&&_.removeData(...e)),type:"button",class:"btn btn-outline-danger"},"確定刪除")])])])],512)}var h=a(2166),_={name:"removeModal",props:["temp-data"],data(){return{item:{}}},methods:{openModal(){this.removeModal.show()},removeData(){this.$emit("remove"),this.removeModal.hide()}},watch:{tempData(e){this.item=e}},mounted(){this.removeModal=new h.u_(this.$refs.removeModal)}},b=a(89);const g=(0,b.Z)(_,[["render",m]]);var v=g},9269:function(e,t,a){a.r(t),a.d(t,{default:function(){return J}});var o=a(3396),s=a(7139);const n={class:"d-flex justify-content-between"},d=(0,o._)("h2",null,[(0,o._)("i",{class:"fa-solid fa-ticket me-1"}),(0,o.Uk)("管理優惠券")],-1),i={class:"table-responsive text-nowrap"},l={class:"table table-striped mt-4 align-middle"},p=(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",null,"優惠券名稱"),(0,o._)("th",null,"優惠碼"),(0,o._)("th",{class:"text-end"},"折扣百分比"),(0,o._)("th",{class:"text-center"},"到期日"),(0,o._)("th",{width:"150",class:"text-center"},"是否啟用"),(0,o._)("th",{width:"150",class:"text-center"},"編輯")])],-1),u={class:"text-end"},c={class:"text-center"},r={class:"text-center"},m={key:0,class:"text-success"},h={key:1},_={class:"text-center"},b=["onClick"],g=["onClick"];function v(e,t,a,v,f,M){const C=(0,o.up)("DashboardPagination"),w=(0,o.up)("CouponModal"),y=(0,o.up)("RemoveModal");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",n,[d,(0,o._)("button",{onClick:t[0]||(t[0]=e=>M.openModal(!0)),type:"button",class:"btn btn-info text-white"}," 新增優惠券 ")]),(0,o._)("div",i,[(0,o._)("table",l,[p,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(f.coupons,((t,a)=>((0,o.wg)(),(0,o.iD)("tr",{key:a},[(0,o._)("td",null,(0,s.zw)(t.title),1),(0,o._)("td",null,(0,s.zw)(t.code),1),(0,o._)("td",u,(0,s.zw)(t.percent)+" %",1),(0,o._)("td",c,(0,s.zw)(e.$filters.date(t.due_date)),1),(0,o._)("td",r,[t.is_enabled?((0,o.wg)(),(0,o.iD)("span",m,"啟用")):((0,o.wg)(),(0,o.iD)("span",h,"未啟用"))]),(0,o._)("td",_,[(0,o._)("button",{onClick:e=>M.openModal(!1,!1,t),type:"button",class:"btn btn-outline-info white-text-btn"}," 編輯 ",8,b),(0,o._)("button",{onClick:e=>M.openModal(!1,!0,t),type:"button",class:"btn btn-outline-danger ms-2"}," 刪除 ",8,g)])])))),128))])])]),(0,o.Wm)(C,{"pagination-data":f.pagination,onGetPagination:M.getCoupons},null,8,["pagination-data","onGetPagination"]),(0,o.Wm)(w,{"temp-data":f.tempCoupon,"is-new":f.isNew,"due-date":f.due_date,onUpdate:M.getCoupons,ref:"couponModal"},null,8,["temp-data","is-new","due-date","onUpdate"]),(0,o.Wm)(y,{"temp-data":f.tempCoupon,onRemove:t[1]||(t[1]=e=>M.removeCoupon(f.tempCoupon.id)),ref:"removeModal"},null,8,["temp-data"])])}var f=a(7676),M=a(9242);const C={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true","data-bs-backdrop":"static",ref:"couponModal"},w={class:"modal-dialog"},y={class:"modal-content"},k={class:"modal-header bg-info text-white"},x={key:0,class:"modal-title fs-5",id:"couponModalLabel"},D={key:1,class:"modal-title fs-5",id:"couponModalLabel"},$=(0,o._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),U={class:"modal-body max-width-input px-6"},P={class:"input-group mb-3"},N={for:"title",class:"form-label"},L={class:"input-group mb-3"},Z={for:"code",class:"form-label"},z={class:"input-group mb-3"},V={for:"due_date",class:"form-label"},S={class:"input-group mb-3"},R={for:"percent",class:"form-label"},W={class:"input-group"},j={class:"form-check"},G={class:"form-check-label",for:"is_enabled"},H={class:"modal-footer"},I=(0,o._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function K(e,t,a,n,d,i){return(0,o.wg)(),(0,o.iD)("div",C,[(0,o._)("div",w,[(0,o._)("div",y,[(0,o._)("div",k,[a.isNew?((0,o.wg)(),(0,o.iD)("h1",x,"新增優惠券")):((0,o.wg)(),(0,o.iD)("h1",D,"編輯 "+(0,s.zw)(d.tempCoupon.title),1)),$]),(0,o._)("div",U,[(0,o._)("div",P,[(0,o._)("label",N,[(0,o.Uk)("優惠券名稱 "),(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>d.tempCoupon.title=e),type:"text",class:"form-control",id:"title",placeholder:"請輸入名稱"},null,512),[[M.nr,d.tempCoupon.title]])])]),(0,o._)("div",L,[(0,o._)("label",Z,[(0,o.Uk)("優惠碼 "),(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>d.tempCoupon.code=e),type:"text",class:"form-control",id:"code",placeholder:"請輸入優惠碼"},null,512),[[M.nr,d.tempCoupon.code]])])]),(0,o._)("div",z,[(0,o._)("label",V,[(0,o.Uk)("到期日 "),(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>d.due_date=e),type:"date",class:"form-control",id:"due_date"},null,512),[[M.nr,d.due_date]])])]),(0,o._)("div",S,[(0,o._)("label",R,[(0,o.Uk)("折扣百分比(%) "),(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>d.tempCoupon.percent=e),type:"number",class:"form-control",id:"percent",placeholder:"請輸入折扣百分比"},null,512),[[M.nr,d.tempCoupon.percent]])])]),(0,o._)("div",W,[(0,o._)("div",j,[(0,o._)("label",G,[(0,o.Uk)(" 是否啟用 "),(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>d.tempCoupon.is_enabled=e),class:"form-check-input",type:"checkbox",id:"is_enabled"},null,512),[[M.e8,d.tempCoupon.is_enabled]])])])])]),(0,o._)("div",H,[I,(0,o._)("button",{onClick:t[5]||(t[5]=(...e)=>i.updateCoupon&&i.updateCoupon(...e)),type:"button",class:"btn btn-info text-white"},"確定")])])])],512)}var O=a(2166),T={name:"CouponModal",props:["temp-data","due-date","isNew"],data(){return{tempCoupon:{title:"",code:"",due_date:0,percent:0,is_enabled:0},due_date:""}},methods:{openModal(){this.couponModal.show()},updateCoupon(){const e=this,t=Math.floor(new Date(e.due_date)/1e3);e.tempCoupon.due_date=t;let a="https://vue-course-api.hexschool.io/api/tommy726/admin/coupon",o="post";e.isNew||(a=`https://vue-course-api.hexschool.io/api/tommy726/admin/coupon/${e.tempCoupon.id}`,o="put"),e.$http[o](a,{data:e.tempCoupon}).then((t=>{t.data.success?e.$store.dispatch("alertModules/updateMessage",{message:t.data.message,status:t.data.success}):e.$store.dispatch("alertModules/updateMessage",{message:"請確認api是否正確",status:t.data.success}),this.due_date=this.dueDate,e.$emit("update"),e.couponModal.hide()})).catch((()=>{e.$store.dispatch("alertModules/updateMessage",{message:"資料取得失敗，請確認api是否正確",status:!1})}))}},watch:{tempData(e){this.tempCoupon=e},dueDate(e){this.due_date=e}},mounted(){const e=this;e.couponModal=new O.u_(e.$refs.couponModal)}},Y=a(89);const A=(0,Y.Z)(T,[["render",K]]);var q=A,B=a(9726),E={name:"AdminCoupons",components:{DashboardPagination:f.Z,CouponModal:q,RemoveModal:B.Z},data(){return{coupons:[],tempCoupon:{title:"",code:"",due_date:0,percent:0,is_enabled:0},due_date:"",pagination:{},isNew:!1}},methods:{getCoupons(e=1){const t=this,a=`https://vue-course-api.hexschool.io/api/tommy726/admin/coupons?page=${e}`;t.$store.dispatch("updateLoading",!0),t.$http.get(a).then((e=>{t.coupons=e.data.coupons,t.pagination=e.data.pagination,t.isLoading=!1,t.$store.dispatch("updateLoading",!1)})).catch((()=>{t.$store.dispatch("alertModules/updateMessage",{message:"資料取得失敗，請確認api是否正確",status:!1})}))},updateCoupon(){const e=this;let t="https://vue-course-api.hexschool.io/api/tommy726/admin/coupon",a="post";e.isNew||(t=`https://vue-course-api.hexschool.io/api/tommy726/admin/coupon/${e.tempCoupon.id}`,a="put"),e.$http[a](t,{data:e.tempCoupon}).then((t=>{t.data.success?e.$store.dispatch("alertModules/updateMessage",{message:t.data.message,status:t.data.success}):e.$store.dispatch("alertModules/updateMessage",{message:"請確認api是否正確",status:t.data.success}),e.couponModal.hide(),e.getCoupons()})).catch((()=>{e.$store.dispatch("alertModules/updateMessage",{message:"資料取得失敗，請確認api是否正確",status:!1})}))},removeCoupon(e){const t=this,a=`https://vue-course-api.hexschool.io/api/tommy726/admin/coupon/${e}`;t.$http.delete(a).then((e=>{t.$store.dispatch("alertModules/updateMessage",{message:e.data.message,status:e.data.success}),t.getCoupons()})).catch((()=>{t.$store.dispatch("alertModules/updateMessage",{message:"資料取得失敗，請確認api是否正確",status:!1})}))},openModal(e,t,a){if(e){this.tempCoupon={};const[e]=new Date(+new Date+288e5).toISOString().split("T");this.due_date=`${e}`,this.isNew=!0,this.$refs.couponModal.openModal()}else if(e||t)this.tempCoupon={...a},this.$refs.removeModal.openModal();else{this.tempCoupon={...a};const[e]=new Date(1e3*this.tempCoupon.due_date).toISOString().split("T");this.due_date=`${e}`,this.isNew=!1,this.$refs.couponModal.openModal()}}},created(){this.getCoupons()}};const F=(0,Y.Z)(E,[["render",v]]);var J=F}}]);
//# sourceMappingURL=269.d9d535fa.js.map