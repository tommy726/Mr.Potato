"use strict";(self["webpackChunkmrpotato"]=self["webpackChunkmrpotato"]||[]).push([[416],{3416:function(t,e,a){a.r(e),a.d(e,{default:function(){return N}});var o=a(3396),s=a(9242),c=a(7139);const r={class:"card"},l=(0,o._)("div",{class:"card-header text-center bg-warning"},[(0,o._)("h5",{class:"card-title my-2"},"確認購物車")],-1),n={class:"card-body d-flex flex-column"},d={class:"table-responsive"},u={class:"table align-middle text-nowrap"},i=(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",{colspan:"2",scope:"col"},"商品名稱"),(0,o._)("th",{scope:"col",class:"text-end"},"單價"),(0,o._)("th",{scope:"col",class:"text-center",width:"100"},"數量"),(0,o._)("th",{scope:"col",class:"text-end"},"總價")])],-1),p={scope:"row"},m=["onClick"],_=(0,o._)("i",{class:"fa-solid fa-trash-can"},null,-1),h=[_],b=["src","alt"],g={class:"text-start"},y={class:"text-end"},f={class:"text-center"},w={class:"input-group",role:"group","aria-label":"quantity input"},C=["onUpdate:modelValue","onChange"],x={class:"text-end"},k={colspan:"4",scope:"row",class:"text-end"},v={for:"coupon",class:"d-flex w-75 align-items-center ms-auto"},D={class:"text-end"},M={scope:"row",colspan:"3",class:"text-end"},$=(0,o._)("td",{class:"text-end fw-bold"},"總計",-1),q={class:"text-end fw-bold"},z={key:0},S={key:1},T={key:0,class:"text-danger"},U=(0,o._)("td",{colspan:"4",scope:"row",class:"text-end fw-bold"},"折扣後",-1),I={class:"text-end fw-bold"};function V(t,e,a,_,V,Q){const H=(0,o.up)("router-link");return(0,o.wg)(),(0,o.iD)("div",r,[l,(0,o._)("div",n,[(0,o._)("div",d,[(0,o._)("table",u,[i,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.cart.carts,(e=>((0,o.wg)(),(0,o.iD)("tr",{key:e.id},[(0,o._)("td",p,[(0,o._)("a",{onClick:(0,s.iM)((t=>Q.removeCart(e.id)),["prevent"]),href:"#","aria-label":"remove"},h,8,m),(0,o._)("img",{src:e.product.imageUrl,alt:e.product.title,class:"checkouts-img"},null,8,b)]),(0,o._)("td",g,(0,c.zw)(e.product.title),1),(0,o._)("td",y,(0,c.zw)(t.$filters.currency(e.product.price)),1),(0,o._)("td",f,[(0,o._)("div",w,[(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":t=>e.qty=t,type:"number",class:"form-control form-control-sm text-center",min:"1","aria-label":"quantity","aria-describedby":"quantity",onChange:t=>Q.debounce((()=>Q.updateCart(e.product.id,e.qty,e.id)))},null,40,C),[[s.nr,e.qty]])])]),(0,o._)("td",x,(0,c.zw)(t.$filters.currency(e.qty*e.product.price)),1)])))),128))]),(0,o._)("tfoot",null,[(0,o._)("tr",null,[(0,o._)("th",k,[(0,o._)("label",v,[(0,o.Uk)("優惠券： "),(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>V.coupon_code=t),type:"text",class:(0,c.C_)(["form-control form-control-sm text-center",{"border-success":t.couponData.status}]),id:"coupon",placeholder:"請輸入優惠碼"},null,2),[[s.nr,V.coupon_code]])])]),(0,o._)("td",D,[(0,o._)("button",{onClick:e[1]||(e[1]=(...t)=>Q.addCouponCode&&Q.addCouponCode(...t)),type:"button",class:"btn btn-outline-secondary"}," 套用 ")])]),(0,o._)("tr",null,[(0,o._)("td",M,"共有 "+(0,c.zw)(Q.totalQuantity)+" 樣商品",1),$,(0,o._)("td",q,[t.couponData.status?((0,o.wg)(),(0,o.iD)("del",z,(0,c.zw)(t.$filters.currency(t.cart.total)),1)):((0,o.wg)(),(0,o.iD)("span",S,(0,c.zw)(t.$filters.currency(t.cart.total)),1))])]),t.couponData.status?((0,o.wg)(),(0,o.iD)("tr",T,[U,(0,o._)("td",I,(0,c.zw)(t.$filters.currency(t.cart.final_total)),1)])):(0,o.kq)("",!0)])])]),(0,o.Wm)(H,{to:"/customer_info",class:"btn btn-outline-primary ms-auto white-text-btn"},{default:(0,o.w5)((()=>[(0,o.Uk)(" 前往結帳資訊 ")])),_:1})])])}var Q=a(65),H={name:"CheckCart",data(){return{coupon_code:localStorage.getItem("couponData")?JSON.parse(localStorage.getItem("couponData")).code:"",debounceTimer:null}},methods:{...(0,Q.nv)("cartsModules",["getCart"]),removeCart(t){this.$store.dispatch("cartsModules/removeCart",t)},debounce(t,e=500){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(t,e)},updateCart(t,e,a){const o=this;o.$store.dispatch("cartsModules/updateCart",{id:t,qty:e,cartId:a}),""!==o.coupon_code&&setTimeout((()=>o.addCouponCode()),300)},addCouponCode(){const t=this,e="https://vue-course-api.hexschool.io/api/tommy726/coupon",a={code:t.coupon_code};t.$http.post(e,{data:a}).then((e=>{if(e.data.success){const a=e.data.success,o=e.data.message.split(":")[1];t.$store.dispatch("cartsModules/changeCouponStatus",{status:a,code:o})}else t.coupon_code="";t.$store.dispatch("alertModules/updateMessage",{message:e.data.message,status:e.data.success}),t.getCart()})).catch((()=>{t.$store.dispatch("alertModules/updateMessage",{message:"資料取得失敗，請確認api是否正確",status:!1})}))}},computed:{...(0,Q.Se)("cartsModules",["cart"]),...(0,Q.Se)("cartsModules",["couponData"]),totalQuantity(){return this.cart.carts.map((t=>t.qty)).reduce(((t,e)=>t+e),0)}},created(){this.getCart()}},J=a(89);const K=(0,J.Z)(H,[["render",V]]);var N=K}}]);
//# sourceMappingURL=416.b318d14c.js.map